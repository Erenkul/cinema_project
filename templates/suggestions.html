<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>ðŸŽ¬ Film Ã–nerileri - ERN Cinema</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
  <style>
    /* Ek gÃ¶rÃ¼nÃ¼rlÃ¼k iyileÅŸtirmeleri */
    body { background-color: #0d0d0d; color: #e5e5e5; }
    .btn-primary { background: #e53e3e; color: white; transition: all 0.3s; padding: 0.75rem 1.5rem; border-radius: 0.5rem; font-weight: 600; }
    .btn-primary:hover { background: #ff4040; transform: scale(1.03); }
    .btn-ghost { background: #222; color: #ccc; border: 1px solid #333; padding: 0.75rem 1.5rem; border-radius: 0.5rem; transition: all 0.3s; }
    .btn-ghost:hover { background: #333; color: #fff; }
    .form-label { color: #ccc; font-weight: 500; display: block; margin-bottom: 0.5rem; }
    .form-input, .form-textarea { background: #1a1a1a; border: 2px solid #333; color: #fff; width: 100%; padding: 0.75rem; border-radius: 0.5rem; transition: all 0.2s; }
    .form-input:focus, .form-textarea:focus { outline: none; border-color: #e53e3e; box-shadow: 0 0 8px rgba(229, 62, 62, 0.3); background: #222; }
    .card { background: #111; border: 1px solid #222; border-radius: 12px; box-shadow: 0 4px 6px rgba(0,0,0,0.3); }
    table th { background-color: #181818; color: #e5e5e5; text-transform: uppercase; padding: 1rem; font-weight: 600; }
    table td { background-color: #121212; border-top: 1px solid #222; padding: 1rem; color: #d1d5db; }
    table tbody tr:hover { background-color: #1a1a1a; }
    .action-btn { display: inline-flex; align-items: center; padding: 0.5rem; border-radius: 0.375rem; transition: all 0.2s; }
    .action-btn-edit { background: #2563eb; color: white; }
    .action-btn-edit:hover { background: #1d4ed8; transform: translateY(-2px); }
    .action-btn-delete { background: #dc2626; color: white; }
    .action-btn-delete:hover { background: #b91c1c; transform: translateY(-2px); }
    .search-box { background: #1a1a1a; border: 2px solid #333; color: #fff; padding: 0.75rem 1rem; border-radius: 0.5rem; width: 100%; }
    .search-box:focus { outline: none; border-color: #e53e3e; box-shadow: 0 0 8px rgba(229, 62, 62, 0.3); }
  </style>
</head>

<body class="bg-primary text-gray-200 fog-effect overflow-y-auto">
  <custom-navbar></custom-navbar>

  <main class="container mx-auto px-4 py-12 max-w-7xl">
    <div class="mb-8">
      <h1 class="text-3xl md:text-4xl font-bold text-white mb-2">ðŸŽ¬ Film Ã–nerileri</h1>
      <p class="text-gray-400">GÃ¶rmek istediÄŸiniz filmleri Ã¶nerin ve diÄŸer kullanÄ±cÄ±larÄ±n Ã¶nerilerini keÅŸfedin.</p>
    </div>

    <!-- Yeni Ã–neri Formu -->
    <div class="card p-6 mb-10">
      <div class="flex items-center mb-4">
        <i data-feather="plus-circle" class="w-6 h-6 text-secondary mr-2"></i>
        <h2 class="text-2xl font-bold text-white">Yeni Film Ã–nerisi</h2>
      </div>
      
      <form action="/suggestions/add" method="POST" class="space-y-4">
        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="form-label">Film AdÄ± *</label>
            <input type="text" name="movie_title" required class="form-input" placeholder="Ã–rn: Inception" />
          </div>
          <div>
            <label class="form-label">YÃ¶netmen</label>
            <input type="text" name="director" class="form-input" placeholder="Ã–rn: Christopher Nolan" />
          </div>
          <div>
            <label class="form-label">TÃ¼r</label>
            <select name="genre" class="form-input">
              <option value="">SeÃ§iniz</option>
              <option>Aksiyon</option><option>Bilim Kurgu</option><option>Komedi</option>
              <option>Drama</option><option>Korku</option><option>Romantik</option>
              <option>Gerilim</option><option>Animasyon</option><option>Belgesel</option>
            </select>
          </div>
          <div>
            <label class="form-label">YÄ±l</label>
            <input type="number" name="year" min="1900" max="2030" class="form-input" placeholder="Ã–rn: 2010" />
          </div>
        </div>

        <div>
          <label class="form-label">Neden Bu Film? *</label>
          <textarea name="reason" required rows="3" class="form-textarea" placeholder="Bu filmi neden gÃ¶rmek istediÄŸinizi aÃ§Ä±klayÄ±n..."></textarea>
        </div>

        <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
          <div>
            <label class="form-label">AdÄ±nÄ±z *</label>
            <input type="text" name="suggested_by" required class="form-input" placeholder="Ad Soyad" />
          </div>
          <div>
            <label class="form-label">E-posta</label>
            <input type="email" name="email" class="form-input" placeholder="ornek@email.com" />
          </div>
        </div>

        <div class="flex justify-end gap-3 mt-4">
          <button type="reset" class="btn-ghost">
            <i data-feather="x" class="w-4 h-4 inline mr-1"></i> Temizle
          </button>
          <button type="submit" class="btn-primary glow-on-hover">
            <i data-feather="send" class="w-4 h-4 inline mr-1"></i> GÃ¶nder
          </button>
        </div>
      </form>
    </div>

    <!-- Filtreler -->
    <div class="card p-4 mb-6">
      <div class="flex flex-col md:flex-row items-center gap-4">
        <div class="w-full md:w-96 relative">
          <input id="searchInput" type="text" placeholder="Ã–nerilerde ara..." class="search-box pl-10" />
          <i data-feather="search" class="w-5 h-5 text-gray-500 absolute left-3 top-1/2 -translate-y-1/2"></i>
        </div>

        <select id="statusFilter" class="form-input md:w-48">
          <option value="all">TÃ¼m Durumlar</option>
          <option value="pending">Beklemede</option>
          <option value="approved">OnaylandÄ±</option>
          <option value="rejected">Reddedildi</option>
        </select>

        <select id="genreFilter" class="form-input md:w-48">
          <option value="all">TÃ¼m TÃ¼rler</option>
          <option value="Aksiyon">Aksiyon</option>
          <option value="Bilim Kurgu">Bilim Kurgu</option>
          <option value="Komedi">Komedi</option>
          <option value="Drama">Drama</option>
          <option value="Korku">Korku</option>
        </select>
      </div>
    </div>

    <!-- Ã–neriler Tablosu -->
    <div class="card overflow-hidden mb-10">
      <div class="overflow-x-auto">
        <table class="table-dark w-full">
          <thead>
            <tr>
              <th>ID</th><th>Film AdÄ±</th><th>YÃ¶netmen</th><th>TÃ¼r</th><th>YÄ±l</th>
              <th>Ã–neren</th><th>Tarih</th><th>Durum</th><th class="text-center">Ä°ÅŸlemler</th>
            </tr>
          </thead>
          <tbody id="suggestionsTableBody">
            {% if suggestions %}
              {% for s in suggestions %}
              <tr class="transition" data-status="{{ s.STATUS }}" data-genre="{{ s.GENRE or '' }}">
                <td class="font-mono text-gray-400">#{{ s.SUGGESTION_ID }}</td>
                <td class="font-semibold text-white">{{ s.MOVIE_TITLE }}</td>
                <td>{{ s.DIRECTOR or '-' }}</td>
                <td>
                  {% if s.GENRE %}
                  <span class="halloween-badge">{{ s.GENRE }}</span>
                  {% else %}
                  -
                  {% endif %}
                </td>
                <td>{{ s.YEAR or '-' }}</td>
                <td>
                  <div>
                    <div class="font-medium">{{ s.SUGGESTED_BY }}</div>
                    {% if s.EMAIL %}
                    <div class="text-xs text-gray-500">{{ s.EMAIL }}</div>
                    {% endif %}
                  </div>
                </td>
                <td>{{ s.CREATED_AT[:10] if s.CREATED_AT else '-' }}</td>
                <td>
                  {% if s.STATUS == 'pending' %}
                    <span class="px-2 py-1 rounded-full text-xs font-semibold bg-yellow-600 text-white">Beklemede</span>
                  {% elif s.STATUS == 'approved' %}
                    <span class="px-2 py-1 rounded-full text-xs font-semibold bg-green-600 text-white">OnaylandÄ±</span>
                  {% else %}
                    <span class="px-2 py-1 rounded-full text-xs font-semibold bg-red-600 text-white">Reddedildi</span>
                  {% endif %}
                </td>
                <td>
                  <div class="flex justify-center gap-2">
                    <a href="/suggestions/update/{{ s.SUGGESTION_ID }}" class="action-btn action-btn-edit" title="DÃ¼zenle">
                      <i data-feather="edit-2" class="w-4 h-4"></i>
                    </a>
                    <a href="/suggestions/delete/{{ s.SUGGESTION_ID }}" 
                       onclick="return confirm('{{ s.MOVIE_TITLE|e }} Ã¶nerisini silmek istediÄŸinizden emin misiniz?')" 
                       class="action-btn action-btn-delete" title="Sil">
                      <i data-feather="trash-2" class="w-4 h-4"></i>
                    </a>
                  </div>
                </td>
              </tr>
              {% endfor %}
            {% else %}
              <tr><td colspan="9" class="text-center text-gray-400 py-8">ðŸŽ¬ HenÃ¼z Ã¶neri bulunmamaktadÄ±r.<br><span class="text-sm mt-2 inline-block">Ä°lk Ã¶neriyi siz yapÄ±n!</span></td></tr>
            {% endif %}
          </tbody>
        </table>
      </div>
    </div>

    <!-- Ä°statistikler -->
    {% if suggestions %}
    <div class="grid grid-cols-1 md:grid-cols-4 gap-6">
      <div class="card text-center p-6">
        <h3 class="text-4xl font-bold text-accent mb-2">{{ suggestions|length }}</h3>
        <p class="text-gray-400">Toplam Ã–neri</p>
      </div>

      <div class="card text-center p-6">
        <h3 class="text-4xl font-bold text-yellow-400 mb-2">
          {{ suggestions|selectattr('STATUS', 'equalto', 'pending')|list|length }}
        </h3>
        <p class="text-gray-400">Beklemede</p>
      </div>

      <div class="card text-center p-6">
        <h3 class="text-4xl font-bold text-green-400 mb-2">
          {{ suggestions|selectattr('STATUS', 'equalto', 'approved')|list|length }}
        </h3>
        <p class="text-gray-400">OnaylandÄ±</p>
      </div>

      <div class="card text-center p-6">
        <h3 class="text-4xl font-bold text-blue-400 mb-2">
          {{ suggestions|map(attribute='GENRE')|reject('equalto', None)|unique|list|length }}
        </h3>
        <p class="text-gray-400">FarklÄ± TÃ¼r</p>
      </div>
    </div>
    {% endif %}
  </main>

  <custom-footer></custom-footer>
  <script src="{{ url_for('static', filename='js/components/navbar.js') }}"></script>
  <script src="{{ url_for('static', filename='js/components/footer.js') }}"></script>
  <script>
    feather.replace();

    // Arama ve Filtreleme
    const searchInput = document.getElementById('searchInput');
    const statusFilter = document.getElementById('statusFilter');
    const genreFilter = document.getElementById('genreFilter');
    const tableBody = document.getElementById('suggestionsTableBody');

    function filterTable() {
      const searchTerm = searchInput.value.toLowerCase();
      const statusValue = statusFilter.value;
      const genreValue = genreFilter.value;

      for (const row of tableBody.querySelectorAll('tr')) {
        const text = row.textContent.toLowerCase();
        const status = row.getAttribute('data-status');
        const genre = row.getAttribute('data-genre');

        const matchesSearch = text.includes(searchTerm);
        const matchesStatus = statusValue === 'all' || status === statusValue;
        const matchesGenre = genreValue === 'all' || genre === genreValue;

        row.style.display = matchesSearch && matchesStatus && matchesGenre ? '' : 'none';
      }
    }

    searchInput.addEventListener('input', filterTable);
    statusFilter.addEventListener('change', filterTable);
    genreFilter.addEventListener('change', filterTable);

    // Form baÅŸarÄ±lÄ± gÃ¶nderimde temizle
    const form = document.querySelector('form');
    if (form) {
      const urlParams = new URLSearchParams(window.location.search);
      if (urlParams.get('success') === 'true') {
        form.reset();
      }
    }
  </script>
</body>
</html>