<!DOCTYPE html>
<html lang="tr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>✏️ Öneri Güncelle - ERN Cinema</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script src="https://unpkg.com/feather-icons"></script>
  <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
</head>

<body class="bg-primary text-gray-200 min-h-screen fog-effect overflow-y-auto">
  <custom-navbar></custom-navbar>

  <main class="container mx-auto px-4 py-12 max-w-4xl">
    <!-- Başlık -->
    <div class="mb-8">
      <div class="flex items-center mb-4">
        <a href="{{ url_for('suggestions') }}" class="mr-4 text-gray-400 hover:text-white transition-colors">
          <i data-feather="arrow-left" class="w-6 h-6"></i>
        </a>
        <div>
          <h1 class="text-3xl md:text-4xl font-bold text-white">✏️ Film Önerisini Güncelle</h1>
          <p class="text-gray-400 mt-1">Öneri bilgilerini düzenleyin</p>
        </div>
      </div>
    </div>

    <!-- Güncelleme Formu -->
    <div class="card p-6 md:p-8">
      <form action="/suggestions/update/{{ suggestion.SUGGESTION_ID }}" method="POST" class="space-y-6">
        
        <!-- Film Bilgileri -->
        <div class="border-b border-gray-700 pb-4">
          <h2 class="text-xl font-bold text-white mb-4 flex items-center">
            <i data-feather="film" class="w-5 h-5 mr-2 text-secondary"></i>
            Film Bilgileri
          </h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <!-- Film Adı -->
            <div class="md:col-span-2">
              <label class="form-label">Film Adı *</label>
              <input type="text" name="movie_title" required 
                     value="{{ suggestion.MOVIE_TITLE }}"
                     class="form-input" placeholder="Örn: Inception">
            </div>

            <!-- Yönetmen -->
            <div>
              <label class="form-label">Yönetmen</label>
              <input type="text" name="director" 
                     value="{{ suggestion.DIRECTOR or '' }}"
                     class="form-input" placeholder="Örn: Christopher Nolan">
            </div>

            <!-- Tür -->
            <div>
              <label class="form-label">Tür</label>
              <select name="genre" class="form-input">
                <option value="">Seçiniz</option>
                <option value="Aksiyon" {% if suggestion.GENRE == 'Aksiyon' %}selected{% endif %}>Aksiyon</option>
                <option value="Bilim Kurgu" {% if suggestion.GENRE == 'Bilim Kurgu' %}selected{% endif %}>Bilim Kurgu</option>
                <option value="Komedi" {% if suggestion.GENRE == 'Komedi' %}selected{% endif %}>Komedi</option>
                <option value="Drama" {% if suggestion.GENRE == 'Drama' %}selected{% endif %}>Drama</option>
                <option value="Korku" {% if suggestion.GENRE == 'Korku' %}selected{% endif %}>Korku</option>
                <option value="Romantik" {% if suggestion.GENRE == 'Romantik' %}selected{% endif %}>Romantik</option>
                <option value="Gerilim" {% if suggestion.GENRE == 'Gerilim' %}selected{% endif %}>Gerilim</option>
                <option value="Animasyon" {% if suggestion.GENRE == 'Animasyon' %}selected{% endif %}>Animasyon</option>
                <option value="Belgesel" {% if suggestion.GENRE == 'Belgesel' %}selected{% endif %}>Belgesel</option>
              </select>
            </div>

            <!-- Yıl -->
            <div>
              <label class="form-label">Yıl</label>
              <input type="number" name="year" min="1900" max="2030" 
                     value="{{ suggestion.YEAR or '' }}"
                     class="form-input" placeholder="Örn: 2010">
            </div>

            <!-- Durum -->
            <div>
              <label class="form-label">Durum *</label>
              <select name="status" class="form-input" required>
                <option value="pending" {% if suggestion.STATUS == 'pending' %}selected{% endif %}>
                  ⏳ Beklemede
                </option>
                <option value="approved" {% if suggestion.STATUS == 'approved' %}selected{% endif %}>
                  ✅ Onaylandı
                </option>
                <option value="rejected" {% if suggestion.STATUS == 'rejected' %}selected{% endif %}>
                  ❌ Reddedildi
                </option>
              </select>
            </div>
          </div>
        </div>

        <!-- Öneri Açıklaması -->
        <div class="border-b border-gray-700 pb-4">
          <h2 class="text-xl font-bold text-white mb-4 flex items-center">
            <i data-feather="message-square" class="w-5 h-5 mr-2 text-secondary"></i>
            Öneri Açıklaması
          </h2>
          
          <div>
            <label class="form-label">Neden Bu Film? *</label>
            <textarea name="reason" required rows="4" 
                      class="form-textarea" 
                      placeholder="Bu filmi neden görmek istediğinizi açıklayın...">{{ suggestion.REASON }}</textarea>
          </div>
        </div>

        <!-- Öneren Kişi Bilgileri -->
        <div class="border-b border-gray-700 pb-4">
          <h2 class="text-xl font-bold text-white mb-4 flex items-center">
            <i data-feather="user" class="w-5 h-5 mr-2 text-secondary"></i>
            Öneren Kişi Bilgileri
          </h2>
          
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
            <div>
              <label class="form-label">Adınız *</label>
              <input type="text" name="suggested_by" required 
                     value="{{ suggestion.SUGGESTED_BY }}"
                     class="form-input" placeholder="Adınız Soyadınız">
            </div>

            <div>
              <label class="form-label">E-posta</label>
              <input type="email" name="email" 
                     value="{{ suggestion.EMAIL or '' }}"
                     class="form-input" placeholder="ornek@email.com">
            </div>
          </div>
        </div>

        <!-- Zaman Bilgileri -->
        <div class="bg-gray-800 rounded-lg p-4 mb-4">
          <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm">
            <div>
              <span class="text-gray-400">Oluşturulma:</span>
              <span class="text-white ml-2">
                {{ suggestion.CREATED_AT.strftime('%Y-%m-%d %H:%M') if suggestion.CREATED_AT else '-' }}
              </span>
            </div>
            <div>
              <span class="text-gray-400">Son Güncelleme:</span>
              <span class="text-white ml-2">
                {{ suggestion.CREATED_AT.strftime('%Y-%m-%d %H:%M') if suggestion.CREATED_AT else '-' }}
              </span>
            </div>
          </div>
        </div>

        <!-- Form Butonları -->
        <div class="flex flex-col sm:flex-row gap-3 justify-end pt-4">
          <a href="{{ url_for('suggestions') }}" class="btn-ghost text-center">
            <i data-feather="x" class="w-4 h-4 inline mr-2"></i>
            İptal
          </a>
          <button type="reset" class="btn-ghost">
            <i data-feather="rotate-ccw" class="w-4 h-4 inline mr-2"></i>
            Sıfırla
          </button>
          <button type="submit" class="btn-primary glow-on-hover">
            <i data-feather="save" class="w-4 h-4 inline mr-2"></i>
            Değişiklikleri Kaydet
          </button>
        </div>
      </form>
    </div>

    <!-- Hızlı İşlemler -->
    <div class="card p-6 mt-6">
      <h3 class="text-lg font-semibold text-white mb-4 flex items-center">
        <i data-feather="zap" class="w-5 h-5 mr-2 text-accent"></i>
        Hızlı İşlemler
      </h3>
      <div class="flex flex-wrap gap-3">
        <a href="/suggestions/status/{{ suggestion.SUGGESTION_ID }}/approved" 
           class="px-4 py-2 bg-green-600 hover:bg-green-700 text-white rounded-lg font-medium transition-all inline-flex items-center">
          <i data-feather="check-circle" class="w-4 h-4 mr-2"></i>
          Onayla
        </a>
        <a href="/suggestions/status/{{ suggestion.SUGGESTION_ID }}/rejected" 
           class="px-4 py-2 bg-red-600 hover:bg-red-700 text-white rounded-lg font-medium transition-all inline-flex items-center">
          <i data-feather="x-circle" class="w-4 h-4 mr-2"></i>
          Reddet
        </a>
        <a href="/suggestions/status/{{ suggestion.SUGGESTION_ID }}/pending" 
           class="px-4 py-2 bg-yellow-600 hover:bg-yellow-700 text-white rounded-lg font-medium transition-all inline-flex items-center">
          <i data-feather="clock" class="w-4 h-4 mr-2"></i>
          Bekletmeye Al
        </a>
        <a href="/suggestions/delete/{{ suggestion.SUGGESTION_ID }}" 
           onclick="return confirm('Bu öneriyi silmek istediğinizden emin misiniz?')"
           class="px-4 py-2 bg-gray-700 hover:bg-gray-800 text-white rounded-lg font-medium transition-all inline-flex items-center">
          <i data-feather="trash-2" class="w-4 h-4 mr-2"></i>
          Öneriyi Sil
        </a>
      </div>
    </div>
  </main>

  <custom-footer></custom-footer>

  <script src="{{ url_for('static', filename='js/components/navbar.js') }}"></script>
  <script src="{{ url_for('static', filename='js/components/footer.js') }}"></script>
  <script>
    feather.replace();

    // Form değişikliklerini takip et
    const form = document.querySelector('form');
    const originalData = new FormData(form);
    let hasChanges = false;

    form.addEventListener('input', () => {
      hasChanges = true;
    });

    // Sayfa kapatılırken uyar
    window.addEventListener('beforeunload', (e) => {
      if (hasChanges) {
        e.preventDefault();
        e.returnValue = '';
      }
    });

    // Form gönderildiğinde uyarıyı kaldır
    form.addEventListener('submit', () => {
      hasChanges = false;
    });
  </script>
</body>
</html>